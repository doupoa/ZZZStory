# 驱动盘评级系统 - 开发者指南

智能分析您的驱动盘配置，计算综合评分

## 目录

- [项目结构](#项目结构)
- [已支持的角色](#已支持的角色)
- [新增可评分角色](#新增可评分角色)
- [评分算法说明](#评分算法说明)
- [技术栈](#技术栈)
- [开发指南](#开发指南)

## 项目结构

```
drive-disk-rating/
├── index.md                    # 页面入口（VitePress）
├── README.md                   # 本文件
└── components/
    ├── DriveRatingApp.vue      # 主应用组件（动态加载角色）
    ├── character-weights.ts    # 角色权重配置
    ├── character-avatar-map.ts # 角色头像映射
    └── rating_algorithm.ts     # 评分算法实现
```

## 已支持的角色

| 角色 | 定位 | 属性类型 | 权重配置 | 头像映射 | 状态 |
|-----|------|--------|---------|---------|------|
| **叶瞬光** | 输出型 | 物理 | ✅ | ✅ | ✅ 已支持 |
| **照** | 防护型 | 冰 | ✅ | ✅ | ✅ 已支持 |
| **悠真** | 输出型 | 电 | ✅ | ✅ | ✅ 已支持 |
| **妮可** | 异常型 | 以太 | ✅ | ✅ | ✅ 已支持 |

**注意**：系统会自动检测同时有权重配置和头像映射的角色，并在下拉选择器中显示。

## 新增可评分角色

要新增一个可评分的角色，只需要完成以下 **2 个步骤**，系统会**自动检测并生效**：

### 步骤 1：添加角色权重配置

编辑文件：`components/character-weights.ts`

在 `characterWeights` 对象中添加新角色的权重配置：

```typescript
export const characterWeights: CharacterWeightConfig = {
  // 现有角色配置...
  
  // 新角色 - 角色名称
  '角色名称': {
    '生命值': 1,           // 权重范围：0-1，1为最高优先级
    '攻击力': 0.5,
    '防御力': 0,
    '冲击力': 0,
    '暴击率': 0.8,
    '暴击伤害': 0.8,
    '物理伤害加成': 1,      // 根据角色属性类型修改
    '异常掌控': 0,
    '异常精通': 0,
    '穿透值': 0.3,
    '穿透率': 0.8,
    '能量自动回复': 0,
    // 小属性（通常为对应大属性权重的1/3）
    '小攻击': 0.17,        // 0.5 × 1/3 ≈ 0.17
    '小生命': 0.33,        // 1 × 1/3 ≈ 0.33
    '小防御': 0
  },
};
```

#### 权重配置说明

| 属性分类 | 属性名称 | 权重建议 | 说明 |
|---------|---------|---------|------|
| **核心属性** | 生命值/攻击力/防御力 | 0-1 | 根据角色定位决定 |
| **暴击属性** | 暴击率/暴击伤害 | 0-1 | 输出型角色通常为1 |
| **伤害加成** | 物理/火/冰/雷/以太伤害加成 | 0-1 | 根据角色伤害类型决定 |
| **穿透属性** | 穿透值/穿透率 | 0-1 | 输出型角色建议0.3-1 |
| **能量属性** | 能量自动回复 | 0-1 | 需要频繁释放技能的角色建议1 |
| **异常属性** | 异常掌控/异常精通 | 0-1 | 异常型角色使用，通常为1 |
| **小属性** | 小攻击/小生命/小防御 | 大属性的1/3 | 根据对应大属性计算 ||

### 步骤 2：添加角色头像映射

编辑文件：`components/character-avatar-map.ts`

在 `characterAvatarMap` 对象中添加新角色的头像映射：

```typescript
export const characterAvatarMap: Record<string, string> = {
  // 现有角色映射...
  
  // 新角色 - 角色名称: 头像文件名
  '角色名称': 'avatar_filename.jpg',
};
```

#### 头像图片要求

- **图片格式**: JPG 或 PNG
- **图片尺寸**: 建议 200×200 像素或以上
- **图片位置**: `/workbench-img/agents/`

#### 头像获取方式

1. **游戏内截图**: 截取角色立绘或头像
2. **官方素材**: 从绝区零官网或社区获取
3. **同人创作**: 使用玩家创作的角色头像（需注意版权）

### 步骤 3：自动生效 ✨

完成上述 2 个步骤后，系统会**自动**：

1. ✅ 检测到新角色的权重配置
2. ✅ 检测到新角色的头像映射
3. ✅ 在下拉选择器中显示新角色
4. ✅ 无需修改任何其他代码
5. ✅ 立即可以使用新角色的评分功能

## 动态角色加载机制

### 工作原理

系统使用 Vue 的计算属性实现角色的动态加载：

```typescript
// 获取所有已配置的角色
const configuredChars = getConfiguredCharacters()  // 从 character-weights.ts
const avataredChars = getAvataredCharacters()      // 从 character-avatar-map.ts

// 求交集：同时存在于两个列表中的角色
const availableCharacters = configuredChars.filter(char => 
  avataredChars.includes(char)
)
```

### 自动更新流程

```
1. 开发者添加角色权重配置
   ↓
2. 开发者添加角色头像映射
   ↓
3. 计算属性自动检测到变化
   ↓
4. 下拉选择器自动显示新角色
   ↓
5. 用户可以立即选择新角色进行评分
```

### 角色有效性判断

| 角色 | 有权重配置 | 有头像映射 | 是否显示 |
|-----|---------|---------|--------|
| **已完成配置** | ✅ 是 | ✅ 是 | ✅ 自动显示 |
| **仅有权重** | ✅ 是 | ❌ 否 | ❌ 不显示 |
| **仅有头像** | ❌ 否 | ✅ 是 | ❌ 不显示 |
| **都没有** | ❌ 否 | ❌ 否 | ❌ 不显示 |

## 评分算法说明

### 算法流程

评分算法遵循以下 **7 个步骤**：

```
输入：驱动盘数据 + 角色权重配置
  ↓
步骤1：计算品质权重 (S/A/B)
  ↓
步骤2：计算等级权重 (0-15级)
  ↓
步骤3：计算有效副词条权重总和
  ↓
步骤4：计算主属性实际权重 (仅4-6号位)
  ↓
步骤5：计算最大权重总和（理想状态）
  ↓
步骤6：计算每权重分值（55 ÷ 最大权重）
  ↓
步骤7：计算实际得分
输出：驱动盘评分 (0-55)
```

### 详细公式

#### 步骤 1：品质权重

```
品质权重 = {
  'S': 1,
  'A': 0.67,
  'B': 0.33
}[rarity]
```

#### 步骤 2：等级权重

```
等级权重 = min(0.25 + level × 0.05, 1)

// 0级: 0.25
// 每升1级: +0.05
// 15级: 1.0
```

#### 步骤 3：有效副词条权重总和

```
有效副词条权重总和 = Σ(属性权重 × 1 + 加成次数 × 属性权重)

// 示例：
// 暴击率 6.0% (add: 1)
// 权重: 1.0
// 计算: 1.0 + 1 × 1.0 = 2.0
```

#### 步骤 4：主属性实际权重（仅4-6号位）

```
主属性实际权重 = 3 × 主属性权重 × 等级权重

// 示例：
// 主属性: 攻击力
// 攻击力权重: 1.0
// 等级: 15级
// 等级权重: 1.0
// 计算: 3 × 1.0 × 1.0 = 3.0
```

#### 步骤 5：最大权重总和

```
最大权重总和 = 副词条最大权重 + 主属性最大权重

// 副词条最大权重计算：
// 取权重前4的属性（排除特殊属性）
// 计算: 6×第1权重 + 1×第2权重 + 1×第3权重 + 1×第4权重

// 主属性最大权重计算：
// 4-6号位且主属性权重>0: 3 × 主属性权重
// 4-6号位且主属性权重=0: 2（视为2条无效词条）
// 1-3号位: 0
```

#### 步骤 6：每权重分值

```
每权重分值 = 55 ÷ 最大权重总和
```

#### 步骤 7：实际得分

```
实际得分 = (副词条权重总和 + 主属性实际权重) × 每权重分值 × 品质权重

最终得分 = round(实际得分 × 10) / 10  // 保留1位小数
```

### 算法特点

1. **角色定制化**: 不同角色有不同的权重配置
2. **动态加载**: 自动检测新增角色，无需修改代码
3. **品质影响**: S/A/B 品质影响最终得分
4. **等级影响**: 驱动盘等级影响主属性权重
5. **位置差异**: 4-6号位有主属性加成，1-3号位没有
6. **满分55**: 理论最高得分为55分

## 技术栈

- **Vue 3**: Composition API + `<script setup>`
- **VitePress**: 静态站点生成器
- **TypeScript**: 类型安全（部分文件）
- **CSS3**: 响应式布局

## 开发指南

### 本地开发

1. 安装依赖：
```bash
npm install
```

2. 启动开发服务器：
```bash
npm run docs:dev
```

3. 访问页面：
```
http://localhost:5173/tools/drive-disk-rating/index
```

### 构建生产版本

```bash
npm run docs:build
```

### 代码规范

- **Vue 组件**: 使用 Composition API 和 `<script setup>`
- **TypeScript**: 为公共函数和接口添加类型定义
- **注释**: 为复杂算法和业务逻辑添加注释
- **命名**: 使用驼峰命名法，变量名见名知意

### 常见问题

#### Q: 如何确定角色的权重配置？

A: 参考以下步骤：
1. 确定角色定位（输出/防护/支援/异常）
2. 查看角色技能和天赋描述
3. 参考社区攻略和推荐
4. 测试调整权重值

#### Q: 为什么主属性权重为0时，最大权重为2？

A: 这是算法设计的一部分：
- 4-6号位的主属性占据2条副词条的位置
- 即使主属性无效（权重为0），也视为占用了2条位置
- 这样设计是为了更准确地反映实际情况

#### Q: 如何测试新角色的评分？

A:
1. 完成上述2个步骤的配置
2. 准备该角色的驱动盘数据（JSON格式）
3. 上传数据并查看评分结果
4. 根据结果调整权重配置

#### Q: 为什么有些角色没有显示在下拉选择器中？

A: 角色必须同时满足以下两个条件才会显示：
1. 在 `character-weights.ts` 中有权重配置
2. 在 `character-avatar-map.ts` 中有头像映射

请检查是否遗漏了某个配置。

## 许可证

本项目遵循 CC BY-NC-SA 4.0 协议

---
 
**最后更新**: 2026年1月20日  
