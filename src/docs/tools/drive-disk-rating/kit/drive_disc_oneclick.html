<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»åŒºé›¶é©±åŠ¨ç›˜ä¸€é”®æå–å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .step {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }

        .step h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .step p {
            line-height: 1.6;
            color: #555;
            margin-bottom: 10px;
        }

        .step code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "Consolas", "Monaco", monospace;
            font-size: 13px;
            color: #d63384;
        }

        .bookmarklet {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px 5px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .bookmarklet:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .bookmarklet:active {
            transform: translateY(0);
        }

        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .result-area {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 200px;
        }

        .result-area h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .result-content {
            background: white;
            padding: 15px;
            border-radius: 6px;
            font-family: "Consolas", "Monaco", monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
        }

        .warning strong {
            color: #856404;
        }

        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
            color: #155724;
        }

        .hidden {
            display: none;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
        }

        .info-box strong {
            color: #1976D2;
        }

        .number-list {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }

        .number-list li {
            position: relative;
            padding-left: 40px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .number-list li::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ç»åŒºé›¶é©±åŠ¨ç›˜ä¸€é”®æå–å·¥å…·</h1>
            <p>ä½¿ç”¨ä¹¦ç­¾è„šæœ¬ï¼Œåœ¨å®˜æ–¹é¡µé¢ä¸€é”®æå–é©±åŠ¨ç›˜æ•°æ®</p>
        </div>

        <div class="content">
            <div class="step">
                <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
                <p>æœ¬å·¥å…·ä½¿ç”¨ä¹¦ç­¾è„šæœ¬æŠ€æœ¯ï¼Œè®©æ‚¨åœ¨ç»åŒºé›¶å®˜æ–¹é¡µé¢ä¸€é”®æå–é©±åŠ¨ç›˜æ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨å¤åˆ¶ç²˜è´´ã€‚</p>
                
                <div class="info-box">
                    <strong>ğŸ’¡ ä»€ä¹ˆæ˜¯ä¹¦ç­¾è„šæœ¬ï¼Ÿ</strong>
                    <p style="margin-top: 8px;">ä¹¦ç­¾è„šæœ¬æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æµè§ˆå™¨ä¹¦ç­¾ï¼Œç‚¹å‡»åä¼šåœ¨å½“å‰é¡µé¢æ‰§è¡Œ JavaScript ä»£ç ï¼Œå®ç°è‡ªåŠ¨åŒ–æ“ä½œã€‚</p>
                </div>
            </div>

            <div class="step">
                <h3>ğŸš€ ä¸€é”®æå–æ­¥éª¤</h3>
                <ul class="number-list">
                    <li>
                        <strong>è®¿é—®å®˜æ–¹é¡µé¢</strong><br>
                        ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰“å¼€ç»åŒºé›¶è§’è‰²ç»ƒåº¦é¡µé¢ï¼Œå¹¶ç¡®ä¿æ‚¨å·²ç™»å½•è´¦å·ã€‚
                        <div style="margin-top: 10px;">
                            <a href="https://act.mihoyo.com/zzz/gt/character-builder-h/index.html#/" target="_blank" class="btn">
                                æ‰“å¼€è§’è‰²ç»ƒåº¦é¡µé¢ â†—
                            </a>
                        </div>
                    </li>
                    <li>
                        <strong>æ·»åŠ ä¹¦ç­¾è„šæœ¬</strong><br>
                        <span class="highlight">æ‹–æ‹½</span> ä¸‹æ–¹çš„æŒ‰é’®åˆ°æµè§ˆå™¨çš„ä¹¦ç­¾æ ä¸­ï¼Œæˆ–è€…å³é”®ç‚¹å‡»æŒ‰é’®é€‰æ‹©"æ·»åŠ åˆ°ä¹¦ç­¾"ã€‚
                        <div style="margin-top: 10px;">
                            <a href="javascript:(async function(){const API_BASE='https://act-api-takumi.mihoyo.com/event/nap_cultivate_tool';const API_LOGIN='https://api-takumi.mihoyo.com/common/badge/v1/login/info';const cleanText=t=>t?.replace(/<[^>]*>/g,'').replace(/\\n/g,'')||'';const fetchJSON=(t,e)=>fetch(t,{credentials:'include',...e}).then(t=>t.json());const getGameUID=async()=>(await fetchJSON(`${API_LOGIN}?game_biz=nap_cn&lang=zh-cn`)).data?.game_uid;const getDeviceFP=()=>document.cookie.match(/DEVICEFP=(\w+)/)?.[1];const getBasicList=(t,e)=>fetchJSON(`${API_BASE}/user/avatar_basic_list?uid=${t}&region=prod_gf_cn`,{headers:{'x-rpc-device_fp':e}});const getEquipBatch=(t,e,o)=>fetchJSON(`${API_BASE}/user/batch_avatar_detail_v2?uid=${t}&region=prod_gf_cn`,{method:'POST',headers:{'x-rpc-device_fp':o},body:JSON.stringify({avatar_list:e})});const processEquipData=({avatar:t,equip:e,weapon:o})=>({characterName:t.name_mi18n,characterFullName:t.full_name_mi18n,level:t.level,profession:t.avatar_profession,driveDiscs:e?.map(({level:t,name:e,icon:o,rarity:a,invalid_property_cnt:i,equipment_type:s,properties:r,main_properties:n,equip_suit:c})=>({position:s,name:e,level:t,rarity:a,invalidProperty:i,mainProperty:{name:n[0].property_name,val:n[0].base},subProperties:r.map(({property_name:t,base:e,level:o,valid:a,add:i})=>({name:t,val:e,level:o,valid:a,add:i})),suit:{name:c.name,desc1:c.desc1,desc2:cleanText(c.desc2)}}))||[]});const uid=await getGameUID();const device_fp=getDeviceFP();if(!uid||!device_fp){alert('âŒ æ— æ³•è¯»å– UID æˆ– DEVICEFPï¼Œå¯èƒ½æœªç™»å½•ï¼');return;}const basicData=await getBasicList(uid,device_fp);const avatarList=basicData.data.list.filter(t=>t.unlocked).map(t=>({avatar_id:t.avatar.id}));const batches=[];for(let t=0;t<avatarList.length;t+=10)batches.push(avatarList.slice(t,t+10));const detailResponses=await Promise.all(batches.map(t=>getEquipBatch(uid,t,device_fp)));const allResults=detailResponses.flatMap(t=>t.data.list.map(processEquipData));const result=allResults.map(t=>({characterName:t.characterName,characterFullName:t.characterFullName,level:t.level,profession:t.profession,driveDiscs:t.driveDiscs.map(e=>({position:e.position,name:e.name,level:e.level,rarity:e.rarity,invalidProperty:e.invalidProperty,mainProperty:{name:e.mainProperty.name,value:e.mainProperty.val},subProperties:e.subProperties.map(t=>({name:t.name,value:t.val,level:t.level,valid:t.valid,add:t.add})),suit:{name:e.suit.name,desc1:e.suit.desc1,desc2:e.suit.desc2}}))}));const jsonResult=JSON.stringify(result,null,2);const blob=new Blob([jsonResult],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='drive_discs_data.json';document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);alert('âœ… é©±åŠ¨ç›˜æ•°æ®æå–æˆåŠŸï¼å·²è‡ªåŠ¨ä¸‹è½½ä¸º drive_discs_data.json');console.log('ğŸ“Š æå–ç»“æœï¼š',result);})();" class="bookmarklet" title="æ‹–æ‹½æ­¤æŒ‰é’®åˆ°ä¹¦ç­¾æ ">
                                ğŸ® ä¸€é”®æå–é©±åŠ¨ç›˜
                            </a>
                        </div>
                        <p style="margin-top: 8px; font-size: 13px; color: #666;">
                            ğŸ’¡ æç¤ºï¼šå¦‚æœçœ‹ä¸åˆ°ä¹¦ç­¾æ ï¼ŒæŒ‰ <code>Ctrl+Shift+B</code> (Windows) æˆ– <code>Cmd+Shift+B</code> (Mac) æ˜¾ç¤º
                        </p>
                    </li>
                    <li>
                        <strong>ä¸€é”®æå–æ•°æ®</strong><br>
                        åœ¨å®˜æ–¹é¡µé¢ç‚¹å‡»ä¹¦ç­¾æ ä¸­çš„ <span class="highlight">"ğŸ® ä¸€é”®æå–é©±åŠ¨ç›˜"</span> æŒ‰é’®ï¼Œè„šæœ¬å°†è‡ªåŠ¨æå–æ‰€æœ‰è§’è‰²çš„é©±åŠ¨ç›˜æ•°æ®å¹¶ä¸‹è½½ä¸º JSON æ–‡ä»¶ã€‚
                    </li>
                </ul>
            </div>

            <div class="warning">
                <strong>âš ï¸ æ³¨æ„äº‹é¡¹ï¼š</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>ç¡®ä¿æ‚¨å·²åœ¨å®˜æ–¹é¡µé¢ç™»å½•ç»åŒºé›¶è´¦å·</li>
                    <li>æå–çš„æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨</li>
                    <li>é¦–æ¬¡ä½¿ç”¨å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…</li>
                    <li>å¦‚æœé‡åˆ°é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œç™»å½•çŠ¶æ€</li>
                    <li>å»ºè®®ä½¿ç”¨ Chromeã€Edge æˆ– Firefox æµè§ˆå™¨</li>
                </ul>
            </div>

            <div class="step">
                <h3>ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜</h3>
                <p>ä»¥ä¸‹æ˜¯JSONæ•°æ®ä¸­å„å­—æ®µçš„è¯¦ç»†è¯´æ˜ï¼š</p>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 13px;">
                    <thead>
                        <tr style="background-color: #f2f2f2;">
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">å­—æ®µè·¯å¾„</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">ç±»å‹</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- è§’è‰²åŸºæœ¬ä¿¡æ¯ -->
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>characterName</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å­—ç¬¦ä¸²</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">è§’è‰²åç§°</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>characterFullName</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å­—ç¬¦ä¸²</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">è§’è‰²å…¨å</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>level</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">æ•°å­—</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">è§’è‰²ç­‰çº§</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>profession</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">æ•°å­—</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">èŒä¸šç±»å‹ï¼ˆ1-6ï¼‰</td>
                        </tr>
                        
                        <!-- é©±åŠ¨ç›˜åŸºæœ¬ä¿¡æ¯ -->
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].position</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">æ•°å­—</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">é©±åŠ¨ç›˜ä½ç½®ï¼ˆ1-6ï¼‰</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].name</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å­—ç¬¦ä¸²</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">é©±åŠ¨ç›˜åç§°</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].level</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">æ•°å­—</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">é©±åŠ¨ç›˜å¼ºåŒ–ç­‰çº§</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].rarity</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å­—ç¬¦ä¸²</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">ç¨€æœ‰åº¦ï¼ˆSã€Aã€Bã€Cï¼‰</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].invalidProperty</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">æ•°å­—</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">æ— æ•ˆå±æ€§æ•°é‡</td>
                        </tr>
                        
                        <!-- å±æ€§ä¿¡æ¯ -->
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].mainProperty</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å¯¹è±¡</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">ä¸»å±æ€§ä¿¡æ¯</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].subProperties</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">æ•°ç»„</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å‰¯å±æ€§åˆ—è¡¨</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].subProperties[].valid</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å¸ƒå°”å€¼</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å±æ€§æ˜¯å¦æœ‰æ•ˆ</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].subProperties[].level</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">æ•°å­—</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å±æ€§å¼ºåŒ–ç­‰çº§</td>
                        </tr>
                        
                        <!-- å¥—è£…ä¿¡æ¯ -->
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].suit</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å¯¹è±¡</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å¥—è£…ä¿¡æ¯</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].suit.desc1</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å­—ç¬¦ä¸²</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">2ä»¶å¥—è£…æ•ˆæœ</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;"><code>driveDiscs[].suit.desc2</code></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">å­—ç¬¦ä¸²</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">4ä»¶å¥—è£…æ•ˆæœ</td>
                        </tr>
                    </tbody>
                </table>
                <p>æå–çš„ JSON æ–‡ä»¶åŒ…å«ä»¥ä¸‹å®Œæ•´ç»“æ„ï¼ˆä»¥è§’è‰²"æ‚ çœŸ"ä¸ºä¾‹ï¼‰ï¼š</p>
                <pre style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px; line-height: 1.5;">
[
  {
    "characterName": "æ‚ çœŸ",
    "characterFullName": "æµ…ç¾½ æ‚ çœŸ",
    "level": 40,
    "profession": 1,
    "driveDiscs": [
      {
        "position": 1,
        "name": "å•„æœ¨é¸Ÿç”µéŸ³[1]",
        "level": 3,
        "rarity": "A",
        "invalidProperty": 0,
        "mainProperty": {
          "name": "ç”Ÿå‘½å€¼",
          "value": "642"
        },
        "subProperties": [
          {
            "name": "é˜²å¾¡åŠ›",
            "value": "3.2%",
            "level": 1,
            "valid": false,
            "add": 0
          },
          {
            "name": "ç”Ÿå‘½å€¼",
            "value": "2%",
            "level": 1,
            "valid": false,
            "add": 0
          },
          {
            "name": "æ”»å‡»åŠ›",
            "value": "2%",
            "level": 1,
            "valid": true,
            "add": 0
          }
        ],
        "suit": {
          "name": "å•„æœ¨é¸Ÿç”µéŸ³",
          "desc1": "æš´å‡»ç‡+8%ã€‚",
          "desc2": "[æ™®é€šæ”»å‡»]ã€[é—ªé¿åå‡»]æˆ–[å¼ºåŒ–ç‰¹æ®ŠæŠ€]å‘½ä¸­æ•Œäººå¹¶è§¦å‘æš´å‡»æ—¶ï¼Œåˆ†åˆ«ä¸ºè£…å¤‡è€…æä¾›1å±‚å¢ç›Šæ•ˆæœï¼Œæ¯å±‚å¢ç›Šæ•ˆæœä½¿è£…å¤‡è€…çš„æ”»å‡»åŠ›æå‡9%ï¼ŒæŒç»­6ç§’ï¼Œä¸åŒæ‹›å¼åˆ†åˆ«ç»“ç®—æŒç»­æ—¶é—´ã€‚"
        }
      },
      {
        "position": 2,
        "name": "å•„æœ¨é¸Ÿç”µéŸ³[2]",
        "level": 6,
        "rarity": "A",
        "invalidProperty": 0,
        "mainProperty": {
          "name": "æ”»å‡»åŠ›",
          "value": "132"
        },
        "subProperties": [
          {
            "name": "é˜²å¾¡åŠ›",
            "value": "10",
            "level": 1,
            "valid": false,
            "add": 0
          },
          {
            "name": "å¼‚å¸¸ç²¾é€š",
            "value": "6",
            "level": 1,
            "valid": false,
            "add": 0
          },
          {
            "name": "ç”Ÿå‘½å€¼",
            "value": "75",
            "level": 1,
            "valid": false,
            "add": 0
          },
          {
            "name": "é˜²å¾¡åŠ›",
            "value": "3.2%",
            "level": 1,
            "valid": false,
            "add": 0
          }
        ],
        "suit": {
          "name": "å•„æœ¨é¸Ÿç”µéŸ³",
          "desc1": "æš´å‡»ç‡+8%ã€‚",
          "desc2": "[æ™®é€šæ”»å‡»]ã€[é—ªé¿åå‡»]æˆ–[å¼ºåŒ–ç‰¹æ®ŠæŠ€]å‘½ä¸­æ•Œäººå¹¶è§¦å‘æš´å‡»æ—¶ï¼Œåˆ†åˆ«ä¸ºè£…å¤‡è€…æä¾›1å±‚å¢ç›Šæ•ˆæœï¼Œæ¯å±‚å¢ç›Šæ•ˆæœä½¿è£…å¤‡è€…çš„æ”»å‡»åŠ›æå‡9%ï¼ŒæŒç»­6ç§’ï¼Œä¸åŒæ‹›å¼åˆ†åˆ«ç»“ç®—æŒç»­æ—¶é—´ã€‚"
        }
      },
      {
        "position": 3,
        "name": "å•„æœ¨é¸Ÿç”µéŸ³[3]",
        "level": 0,
        "rarity": "A",
        "invalidProperty": 0,
        "mainProperty": {
          "name": "é˜²å¾¡åŠ›",
          "value": "31"
        },
        "subProperties": [
          {
            "name": "é˜²å¾¡åŠ›",
            "value": "3.2%",
            "level": 1,
            "valid": false,
            "add": 0
          },
          {
            "name": "æš´å‡»ç‡",
            "value": "1.6%",
            "level": 1,
            "valid": true,
            "add": 0
          }
        ],
        "suit": {
          "name": "å•„æœ¨é¸Ÿç”µéŸ³",
          "desc1": "æš´å‡»ç‡+8%ã€‚",
          "desc2": "[æ™®é€šæ”»å‡»]ã€[é—ªé¿åå‡»]æˆ–[å¼ºåŒ–ç‰¹æ®ŠæŠ€]å‘½ä¸­æ•Œäººå¹¶è§¦å‘æš´å‡»æ—¶ï¼Œåˆ†åˆ«ä¸ºè£…å¤‡è€…æä¾›1å±‚å¢ç›Šæ•ˆæœï¼Œæ¯å±‚å¢ç›Šæ•ˆæœä½¿è£…å¤‡è€…çš„æ”»å‡»åŠ›æå‡9%ï¼ŒæŒç»­6ç§’ï¼Œä¸åŒæ‹›å¼åˆ†åˆ«ç»“ç®—æŒç»­æ—¶é—´ã€‚"
        }
      },
      {
        "position": 4,
        "name": "å•„æœ¨é¸Ÿç”µéŸ³[4]",
        "level": 0,
        "rarity": "A",
        "invalidProperty": 0,
        "mainProperty": {
          "name": "æš´å‡»ç‡",
          "value": "4%"
        },
        "subProperties": [
          {
            "name": "æš´å‡»ä¼¤å®³",
            "value": "3.2%",
            "level": 1,
            "valid": true,
            "add": 0
          },
          {
            "name": "å¼‚å¸¸ç²¾é€š",
            "value": "6",
            "level": 1,
            "valid": false,
            "add": 0
          },
          {
            "name": "æ”»å‡»åŠ›",
            "value": "13",
            "level": 1,
            "valid": false,
            "add": 0
          }
        ],
        "suit": {
          "name": "å•„æœ¨é¸Ÿç”µéŸ³",
          "desc1": "æš´å‡»ç‡+8%ã€‚",
          "desc2": "[æ™®é€šæ”»å‡»]ã€[é—ªé¿åå‡»]æˆ–[å¼ºåŒ–ç‰¹æ®ŠæŠ€]å‘½ä¸­æ•Œäººå¹¶è§¦å‘æš´å‡»æ—¶ï¼Œåˆ†åˆ«ä¸ºè£…å¤‡è€…æä¾›1å±‚å¢ç›Šæ•ˆæœï¼Œæ¯å±‚å¢ç›Šæ•ˆæœä½¿è£…å¤‡è€…çš„æ”»å‡»åŠ›æå‡9%ï¼ŒæŒç»­6ç§’ï¼Œä¸åŒæ‹›å¼åˆ†åˆ«ç»“ç®—æŒç»­æ—¶é—´ã€‚"
        }
      },
      {
        "position": 5,
        "name": "æ··æ²Œé‡é‡‘å±[5]",
        "level": 0,
        "rarity": "B",
        "invalidProperty": 0,
        "mainProperty": {
          "name": "ç‰©ç†ä¼¤å®³åŠ æˆ",
          "value": "2.5%"
        },
        "subProperties": [
          {
            "name": "ç”Ÿå‘½å€¼",
            "value": "1%",
            "level": 1,
            "valid": false,
            "add": 0
          }
        ],
        "suit": {
          "name": "æ··æ²Œé‡é‡‘å±",
          "desc1": "ä»¥å¤ªä¼¤å®³+10%ã€‚",
          "desc2": "è£…å¤‡è€…çš„æš´å‡»ä¼¤å®³æå‡20%ï¼Œé˜Ÿä¼ä¸­ä»»æ„è§’è‰²è§¦å‘[ä¾µèš€]æ•ˆæœçš„é¢å¤–ä¼¤å®³æ—¶ï¼Œè¯¥å¢ç›Šæ•ˆæœé¢å¤–æå‡5.5%ï¼Œæœ€å¤šå åŠ 6å±‚ï¼ŒæŒç»­8ç§’ï¼Œé‡å¤è§¦å‘æ—¶åˆ·æ–°æŒç»­æ—¶é—´ã€‚"
        }
      },
      {
        "position": 6,
        "name": "éœ‡æ˜Ÿè¿ªæ–¯ç§‘[6]",
        "level": 0,
        "rarity": "B",
        "invalidProperty": 0,
        "mainProperty": {
          "name": "ç”Ÿå‘½å€¼",
          "value": "2.5%"
        },
        "subProperties": [
          {
            "name": "ç”Ÿå‘½å€¼",
            "value": "37",
            "level": 1,
            "valid": false,
            "add": 0
          },
          {
            "name": "æš´å‡»ä¼¤å®³",
            "value": "1.6%",
            "level": 1,
            "valid": true,
            "add": 0
          }
        ],
        "suit": {
          "name": "éœ‡æ˜Ÿè¿ªæ–¯ç§‘",
          "desc1": "å†²å‡»åŠ›+6%ã€‚",
          "desc2": "[æ™®é€šæ”»å‡»]ã€[å†²åˆºæ”»å‡»]ã€[é—ªé¿åå‡»]å¯¹ä¸»è¦æ”»å‡»ç›®æ ‡é€ æˆçš„å¤±è¡¡å€¼æå‡20%ã€‚"
        }
      }
    ]
  }
]</pre>
            </div>

            <div class="step">
                <h3>â“ å¸¸è§é—®é¢˜</h3>
                <p><strong>Q: ä¹¦ç­¾æ åœ¨å“ªé‡Œï¼Ÿ</strong><br>
                A: æµè§ˆå™¨é¡¶éƒ¨é€šå¸¸æœ‰ä¸€ä¸ªä¹¦ç­¾æ ã€‚å¦‚æœæ²¡æœ‰æ˜¾ç¤ºï¼ŒæŒ‰ <code>Ctrl+Shift+B</code> (Windows) æˆ– <code>Cmd+Shift+B</code> (Mac) æ˜¾ç¤ºã€‚</p>
                
                <p style="margin-top: 10px;"><strong>Q: æ‹–æ‹½æŒ‰é’®åˆ°ä¹¦ç­¾æ æ²¡æœ‰ååº”ï¼Ÿ</strong><br>
                A: å¯ä»¥å³é”®ç‚¹å‡»æŒ‰é’®ï¼Œé€‰æ‹©"æ·»åŠ åˆ°ä¹¦ç­¾"ï¼Œç„¶åæ‰‹åŠ¨æ·»åŠ åˆ°ä¹¦ç­¾æ ã€‚</p>
                
                <p style="margin-top: 10px;"><strong>Q: ç‚¹å‡»ä¹¦ç­¾åæ²¡æœ‰ååº”ï¼Ÿ</strong><br>
                A: ç¡®ä¿æ‚¨åœ¨ç»åŒºé›¶å®˜æ–¹é¡µé¢ï¼ˆact.mihoyo.comï¼‰ï¼Œå¹¶ä¸”å·²ç™»å½•è´¦å·ã€‚</p>
                
                <p style="margin-top: 10px;"><strong>Q: æå–å¤±è´¥æ€ä¹ˆåŠï¼Ÿ</strong><br>
                A: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¡®è®¤å·²ç™»å½•ï¼Œåˆ·æ–°é¡µé¢åé‡è¯•ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // æ£€æµ‹æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            const mobileWarning = document.createElement('div');
            mobileWarning.className = 'warning';
            mobileWarning.innerHTML = '<strong>âš ï¸ ç§»åŠ¨è®¾å¤‡æç¤ºï¼š</strong>ä¹¦ç­¾è„šæœ¬åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨ä¸ä¾¿ï¼Œå»ºè®®ä½¿ç”¨ç”µè„‘æµè§ˆå™¨è¿›è¡Œæ“ä½œã€‚';
            document.querySelector('.content').insertBefore(mobileWarning, document.querySelector('.content').firstChild);
        }

        // æä¾›æ‰‹åŠ¨å¤åˆ¶ä»£ç çš„åŠŸèƒ½
        function showManualCode() {
            const code = `(async function(){
    const API_BASE = 'https://act-api-takumi.mihoyo.com/event/nap_cultivate_tool';
    const API_LOGIN = 'https://api-takumi.mihoyo.com/common/badge/v1/login/info';
    
    const cleanText = t => t?.replace(/<[^>]*>/g, '').replace(/\\n/g, '') || '';
    
    const fetchJSON = (t, e) => fetch(t, {credentials: 'include', ...e}).then(t => t.json());
    
    const getGameUID = async () => (await fetchJSON(\`\${API_LOGIN}?game_biz=nap_cn&lang=zh-cn\`)).data?.game_uid;
    
    const getDeviceFP = () => document.cookie.match(/DEVICEFP=(\\w+)/)?.[1];
    
    const getBasicList = (t, e) => fetchJSON(\`\${API_BASE}/user/avatar_basic_list?uid=\${t}&region=prod_gf_cn\`, {
        headers: {'x-rpc-device_fp': e}
    });
    
    const getEquipBatch = (t, e, o) => fetchJSON(\`\${API_BASE}/user/batch_avatar_detail_v2?uid=\${t}&region=prod_gf_cn\`, {
        method: 'POST',
        headers: {'x-rpc-device_fp': o},
        body: JSON.stringify({avatar_list: e})
    });
    
    const processEquipData = ({avatar: t, equip: e, weapon: o}) => ({
        characterName: t.name_mi18n,
        characterFullName: t.full_name_mi18n,
        level: t.level,
        profession: t.avatar_profession,
        driveDiscs: e?.map(({level: t, name: e, icon: o, rarity: a, invalid_property_cnt: i, equipment_type: s, properties: r, main_properties: n, equip_suit: c}) => ({
            position: s,
            name: e,
            level: t,
            rarity: a,
            invalidProperty: i,
            mainProperty: {name: n[0].property_name, val: n[0].base},
            subProperties: r.map(({property_name: t, base: e, level: o, valid: a, add: i}) => ({
                name: t, val: e, level: o, valid: a, add: i
            })),
            suit: {name: c.name, desc1: c.desc1, desc2: cleanText(c.desc2)}
        })) || []
    });
    
    const uid = await getGameUID();
    const device_fp = getDeviceFP();
    
    if (!uid || !device_fp) {
        alert('âŒ æ— æ³•è¯»å– UID æˆ– DEVICEFPï¼Œå¯èƒ½æœªç™»å½•ï¼');
        return;
    }
    
    const basicData = await getBasicList(uid, device_fp);
    const avatarList = basicData.data.list.filter(t => t.unlocked).map(t => ({avatar_id: t.avatar.id}));
    
    const batches = [];
    for (let i = 0; i < avatarList.length; i += 10) {
        batches.push(avatarList.slice(i, i + 10));
    }
    
    const detailResponses = await Promise.all(batches.map(t => getEquipBatch(uid, t, device_fp)));
    
    const allResults = detailResponses.flatMap(t => t.data.list.map(processEquipData));
    
    const result = allResults.map(t => ({
        characterName: t.characterName,
        characterFullName: t.characterFullName,
        level: t.level,
        profession: t.profession,
        driveDiscs: t.driveDiscs.map(e => ({
            position: e.position,
            name: e.name,
            level: e.level,
            rarity: e.rarity,
            invalidProperty: e.invalidProperty,
            mainProperty: {name: e.mainProperty.name, value: e.mainProperty.val},
            subProperties: e.subProperties.map(t => ({
                name: t.name, value: t.val, level: t.level, valid: t.valid, add: t.add
            })),
            suit: {name: e.suit.name, desc1: e.suit.desc1, desc2: e.suit.desc2}
        }))
    }));
    
    const jsonResult = JSON.stringify(result, null, 2);
    const blob = new Blob([jsonResult], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'drive_discs_data.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('âœ… é©±åŠ¨ç›˜æ•°æ®æå–æˆåŠŸï¼å·²è‡ªåŠ¨ä¸‹è½½ä¸º drive_discs_data.json');
    console.log('ğŸ“Š æå–ç»“æœï¼š', result);
})();`;

            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>æ‰‹åŠ¨å¤åˆ¶ä»£ç </title>
                    <style>
                        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
                        pre { background: white; padding: 20px; border-radius: 8px; overflow-x: auto; }
                        button { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; }
                        button:hover { background: #5568d3; }
                    </style>
                </head>
                <body>
                    <h2>å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°å®˜æ–¹é¡µé¢çš„æ§åˆ¶å°ä¸­ï¼š</h2>
                    <pre>${code}</pre>
                    <button onclick="navigator.clipboard.writeText(document.querySelector('pre').textContent); alert('å·²å¤åˆ¶ï¼')">å¤åˆ¶ä»£ç </button>
                </body>
                </html>
            `);
        }
    </script>
</body>
</html>